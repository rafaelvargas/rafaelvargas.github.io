---
layout: post
title: "Managed Airflow Instances"
subtitle: "Are they really worth it?"
---

I've been reading about the managed Airflow instances solutions that some cloud service providers sell. Google, with its [Google Cloud Composer](https://cloud.google.com/composer/docs/concepts/overview) and Amazon, with its [Amazon Managed Workflows](https://aws.amazon.com/managed-workflows-for-apache-airflow/), are some of the examples. At first glance, they seem to look similar: both provide the benefits of not generating concerns about the management of the infrastruture that runs the Airflow instances. But, are they really worth it?


## A brief explanation on Airflow

Let's start by explaining briefly what [Airflow](https://airflow.apache.org/) is: an open-source platform written in Python to schedule and monitor workflows. It has a scheduler, that spawns jobs locally or in distributed workers, using [Celery](https://docs.celeryproject.org/en/stable/) or [Kubernetes](https://kubernetes.io/), for example, to run tasks periodically. It also has a web server module, that basically provides an user interface to manage and monitor the workflows.

Its paradigm, that defines the worflows as code, by abstracting it using [DAGs](https://en.wikipedia.org/wiki/Directed_acyclic_graph), seems to be the most valuable characteristic from it. With this, we can properly track the modifications during the development of the workflows, and also be able to work simultaneuoslly with other people on a worflow. Both of this tasks are difficult when using other platforms, specially the ones that provide an user interface for defining the worflows (see [SSIS](https://docs.microsoft.com/en-us/sql/integration-services/sql-server-integration-services), for example). Still, there are companies who have a different point of view on this topic (see [uWorc](https://eng.uber.com/no-code-workflow-orchestrator/), from Uber). 

Well, fact is, since its first introduction, in 2014, by [Airbnb](https://airbnb.io/), it gained a lot of popularity across the data teams in companies.


## Managed Airflow instances advantages

As said earlier, an Airflow instance can be deployed in different ways. You could have it on an on-premise server (or cluster), depending on what are your necessities, or on cloud, using, again, just one server, or multiple nodes. Both options, though, imply that you have to maintain the infrastructure underlying it -- with different levels of management requirements, of course. That's where the managed instances comes in.

The managed instances sold by the cloud providers supply the benefit of not generating concerns about the management of the infrastructure to run the instances. The statement itself seems kind of attractive, because it would imply that the companies wouldn't have costs with [DevOps](https://en.wikipedia.org/wiki/DevOps). The managed instances also provide good [CI/CD](https://en.wikipedia.org/wiki/CI/CD) capabilities, which is great.

You can also easily scale your environment [horizontally](https://en.wikipedia.org/wiki/Scalability#Horizontal_(scale_out)_and_vertical_scaling_(scale_up)). The Amazon solution even provides an auto-scaling feature. The provisioning and management of the database that stores the metadata generated by the workflows is also done automatically.

## Managed Airflow instances disadvantages

The idea of focusing on business problems by using the managed instances is interesting. The idea, however, has some limitations. 

### Customization

Let's suppose you want to install a specific [ODBC](https://en.wikipedia.org/wiki/Open_Database_Connectivity) driver to connect with a database that is maintained by your company, to extract the data that is stored in it. You probally won't be able to do it, because you won't have control of the servers that are running the instances. 

Another possible limitation is that, if you wanted to write custom Airflow components, like a custom authentication backend, for example, you won't be able as well.

### Cost

One of the most important aspects of the choice of using or not using this type of solutions is related to its cost. Let's analyse some  at the moment this post is being written:

#### Amazon

Considering a small size environment at the region US East (N. Virginia):

Specifications: 

- Scheduler: 1 vCPU
- Worker: 1 vCPU
- Web Server: 0.5 vCPU

Prices:

- Environment: $0.49 per hour
- Worker price: $0.055
- Metadata storage: $0.10 per GB-Month

Supposing 9 additional workers are used for one hour a day, and 5GB of metadata being generated per month, we would have:

- Environment charge: 31 days * 24h * $0.49 = $364.56 
- Workers charge: 31 days * 1h * $0.055 = $15.34
- Metadata storage: 5GB * $0.10 = $0.5

**Total**: $380.40


Source can be found in [here](https://aws.amazon.com/managed-workflows-for-apache-airflow/pricing/
). 
#### Google





